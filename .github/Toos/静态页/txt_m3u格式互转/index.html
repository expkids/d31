<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV æ ¼å¼è½¬æ¢å·¥å…· (M3U â†” TXT) </title>
    <link rel="icon" href="https://cloudflare-imgbed-8o0.pages.dev/file/1769750780357_256.webp" type="image/png">
    <style>
        :root { --primary: #007aff; --success: #34c759; --danger: #ff3b30; --gray: #8e8e93; --safe-bg: #eafaf1; --safe-text: #27ae60; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 1000px; margin: 40px auto; padding: 0 20px; background: #f0f2f5; color: #333; }
        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); position: relative; }
        h2 { text-align: center; margin-bottom: 10px; font-weight: 600; color: #1d1d1f; }
        
        .safe-banner { 
            text-align: center; 
            background: var(--safe-bg); 
            color: var(--safe-text); 
            padding: 8px 15px; 
            border-radius: 8px; 
            font-size: 13px; 
            margin-bottom: 25px; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .upload-area { display: flex; justify-content: center; margin-bottom: 20px; }
        .file-label { background: var(--primary); color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-weight: 500; }
        .file-label:hover { opacity: 0.9; transform: translateY(-1px); }
        #fileUp { display: none; }

        textarea { width: 100%; height: 350px; margin: 10px 0; padding: 15px; border: 2px solid #eee; border-radius: 12px; font-family: "Fira Code", monospace; font-size: 14px; box-sizing: border-box; transition: border-color 0.3s; }
        textarea:focus { outline: none; border-color: var(--primary); }

        .btn-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-top: 20px; }
        button { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s; color: white; }
        
        .btn-convert-m3u { background: #5856d6; }
        .btn-convert-txt { background: #af52de; }
        .btn-copy { background: #ff9500; }
        .btn-download { background: var(--success); }
        .btn-clear { background: var(--danger); }
        button:hover { filter: brightness(1.1); transform: translateY(-1px); }
        button:active { transform: translateY(0); }

        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 12px 25px; border-radius: 50px; color: white; font-size: 14px; display: none; z-index: 100; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div class="card">
    <h2>IPTV æ ¼å¼äº’è½¬å·¥å…·</h2>
    
    <div class="safe-banner">
        <span>ğŸ›¡ï¸ çº¯å‰ç«¯é€»è¾‘å¤„ç†ï¼Œæ‰€æœ‰è½¬æ¢å‡åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆï¼Œä¸ä¼šä¸Šä¼ æ•°æ®åˆ°æœåŠ¡å™¨ï¼Œè¯·æ”¾å¿ƒä½¿ç”¨ã€‚</span>
    </div>
    
    <div class="upload-area">
        <label class="file-label" for="fileUp">ğŸ“ ä¸Šä¼  M3U æˆ– TXT æ–‡ä»¶</label>
        <input type="file" id="fileUp" accept=".txt,.m3u">
    </div>

    <textarea id="mainArea" placeholder="åœ¨æ­¤ç²˜è´´å†…å®¹...&#10;æ”¯æŒæ ¼å¼ï¼šåç§°,video://https://...&#10;æ”¯æŒè‡ªåŠ¨è¿‡æ»¤ '(ç½‘é¡µ)' åç¼€"></textarea>

    <div class="btn-container">
        <button class="btn-convert-m3u" onclick="convert('toM3u')">è½¬ä¸º M3U æ ¼å¼</button>
        <button class="btn-convert-txt" onclick="convert('toTxt')">è½¬ä¸º TXT æ ¼å¼</button>
        <button class="btn-copy" onclick="copyToClipboard()">ä¸€é”®å¤åˆ¶å†…å®¹</button>
        <button class="btn-download" onclick="downloadFile()">æ™ºèƒ½ä¸‹è½½ç»“æœ</button>
        <button class="btn-clear" onclick="clearContent()">æ¸…ç©ºå…¨éƒ¨</button>
    </div>
</div>

<div id="toast" class="toast"></div>

<script>
    const area = document.getElementById('mainArea');
    const toast = document.getElementById('toast');

    // æ–‡ä»¶è¯»å–
    document.getElementById('fileUp').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            area.value = e.target.result;
            showToast("æ–‡ä»¶åŠ è½½æˆåŠŸ", "#34c759");
        };
        reader.readAsText(file);
    });

    // å¼¹çª—æç¤º
    function showToast(msg, color) {
        toast.innerText = msg;
        toast.style.backgroundColor = color;
        toast.style.display = 'block';
        setTimeout(() => { toast.style.display = 'none'; }, 2500);
    }

    // ä¿®å¤åçš„è½¬æ¢é€»è¾‘
    function convert(type) {
        const input = area.value.trim();
        if (!input) return showToast("å†…å®¹ä¸ºç©ºï¼", "#ff3b30");

        if (type === 'toM3u') {
            // ä¿®å¤ï¼šæ”¾å®½æ­£åˆ™ï¼Œæ”¯æŒ video:// å‰ç¼€
            if (!/.*?,(http|rtsp|rtmp|p3p|mms|video)/i.test(input)) {
                return showToast("æ ¼å¼ä¸ç¬¦åˆï¼šæœªæ£€æµ‹åˆ° 'åç§°,é“¾æ¥'", "#ff3b30");
            }
            const lines = input.split('\n');
            let output = "#EXTM3U\n";
            let currentGroup = "æœªåˆ†ç±»";

            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                // å¤„ç†åˆ†ç±»è¡Œ #genre#
                if (line.includes('#genre#')) {
                    currentGroup = line.split(',')[0].trim();
                    return;
                }

                // å¤„ç†å¸¸è§„é¢‘é“è¡Œ
                if (line.includes(',') && line.includes('://')) {
                    const parts = line.split(',');
                    let url = parts.pop().trim();
                    let name = parts.join(',').trim();
                    
                    // ä¿®å¤ï¼šå‰¥ç¦» video:// å‰ç¼€ï¼Œä½¿æ’­æ”¾å™¨å¯è¯»
                    url = url.replace(/^video:\/\//i, '');
                    
                    // ä¼˜åŒ–ï¼šå»æ‰åç§°ä¸­çš„ (ç½‘é¡µ)
                    name = name.replace(/\(ç½‘é¡µ\)/g, '').trim();
                    
                    output += `#EXTINF:-1 group-title="${currentGroup}",${name}\n${url}\n`;
                }
            });
            area.value = output;
            showToast("å·²æˆåŠŸè½¬ä¸º M3U", "#5856d6");
        } 
        else {
            if (!input.includes("#EXTINF")) {
                return showToast("æ ¼å¼ä¸ç¬¦åˆï¼šæœªæ£€æµ‹åˆ° M3U ç‰¹å¾", "#ff3b30");
            }
            const lines = input.split('\n');
            let output = "";
            let currentName = "";
            lines.forEach(line => {
                line = line.trim();
                if (line.startsWith("#EXTINF:")) {
                    const match = line.match(/#EXTINF:.*?,(.*)/);
                    if (match) currentName = match[1].trim();
                } else if (line.includes("://") && !line.startsWith('#')) {
                    output += `${currentName || 'æœªçŸ¥é¢‘é“'},${line}\n`;
                }
            });
            area.value = output;
            showToast("å·²æˆåŠŸè½¬ä¸º TXT", "#af52de");
        }
    }

    // ä¸€é”®å¤åˆ¶
    function copyToClipboard() {
        if (!area.value.trim()) return showToast("æ²¡æœ‰å†…å®¹å¯ä»¥å¤åˆ¶", "#ff3b30");
        navigator.clipboard.writeText(area.value).then(() => {
            showToast("å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿", "#ff9500");
        }).catch(() => {
            area.select();
            document.execCommand('copy');
            showToast("å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿", "#ff9500");
        });
    }

    // æ™ºèƒ½ä¸‹è½½
    function downloadFile() {
        const content = area.value.trim();
        if (!content) return showToast("å†…å®¹ä¸ºç©ºï¼Œæ— æ³•ä¸‹è½½", "#ff3b30");
        const isM3u = content.includes("#EXTM3U");
        const fileName = isM3u ? "live.m3u" : "live.txt";
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showToast(`å·²ä¸‹è½½ ${fileName}`, "#34c759");
    }

    // æ¸…ç©º
    function clearContent() {
        area.value = "";
        showToast("å·²æ¸…ç©ºå†…å®¹", "#8e8e93");
    }
</script>

</body>
</html>