name: Auto Update JS MD5

on:
  # ç›‘å¬ä»£ç æ¨é€
  push:
    # åªæœ‰å½“ .js æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶æ‰è§¦å‘ï¼Œé¿å…æ— æ„ä¹‰è¿è¡Œ
    paths:
      - '**.js'
      - '.github/workflows/md5.yml' # æ–¹ä¾¿è°ƒè¯•è„šæœ¬æœ¬èº«

permissions:
  contents: write

jobs:
  generate-md5:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v6
        with:
          fetch-depth: 0 # è·å–å®Œæ•´å†å²ï¼Œæ–¹ä¾¿æäº¤

      - name: ğŸ§® Calculate & Update MD5
        run: |
          echo "å¼€å§‹æ‰«ææ‰€æœ‰ .js æ–‡ä»¶..."
          
          find . -type f -name "*.js" -not -path '*/.git/*' | while read -r file; do
            
            current_md5=$(md5sum "$file" | awk '{print $1}')

            target_file="${file}.md5"

            echo "$current_md5" > "$target_file"
            
            echo "âœ… å·²æ›´æ–°: $target_file -> $current_md5"
          done

      - name: ğŸ“¤ Commit & Push Changes
        run: |
          # é…ç½®æœºå™¨äººèº«ä»½
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

          git add **/*.js.md5

          if ! git diff-index --quiet HEAD; then
            git commit -m "Update md5"
            git push
            echo "::notice::ğŸš€ MD5 æ–‡ä»¶å·²æ›´æ–°å¹¶æ¨é€ï¼"
          else
            echo "::notice::âš ï¸ MD5 å€¼æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡æäº¤ã€‚"
          fi